{"version":3,"sources":["flux.transitions.js"],"names":["define","$","flux","fn","css3","props","css","prefixes","prop","i","length","this","transitionEnd","callback","events","bind","event","j","unbind","call","transition","fluxslider","opts","options","extend","requires3d","after","slider","browser","supports3d","supportsTransitions","fallback","_this","undefined","setup","fallbackSetup","execute","fallbackExecute","prototype","constructor","hasFinished","run","image1","background-image","imageContainer","setTimeout","finished","setupImages","element","trigger","currentImage","getImage","currentImageIndex","transitions","transition_grid","columns","rows","forceSquare","imgWidth","width","imgHeight","height","colWidth","Math","floor","rowHeight","colRemainder","colAddPerLoop","ceil","rowRemainder","rowAddPerLoop","totalLeft","totalTop","fragment","document","createDocumentFragment","thisColWidth","add","thisRowHeight","thisRowRemainder","tile","position","top","left","renderTile","appendChild","get","bars","find","image2","hide","last","show","transform","rotateX","translate","elem","colIndex","rowIndex","leftOffset","topOffset"],"mappings":"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","file":"../flux.transitions.js","sourcesContent":["define([\n\t\"skylark-jquery\",\n\t\"./flux\"\n],function($,flux) {\n\t/**\n\t * Helper function for cross-browser CSS3 support, prepends all possible prefixes to all properties passed in\n\t * @param {Object} props Ker/value pairs of CSS3 properties\n\t */\n\t$.fn.css3 = function(props) {\n\t\tvar css = {};\n\t\tvar prefixes = ['webkit', 'moz', 'ms', 'o'];\n\n\t\tfor(var prop in props)\n\t\t{\n\t\t\t// Add the vendor specific versions\n\t\t\tfor(var i=0; i<prefixes.length; i++)\n\t\t\t\tcss['-'+prefixes[i]+'-'+prop] = props[prop];\n\t\t\t\n\t\t\t// Add the actual version\t\n\t\t\tcss[prop] = props[prop];\n\t\t}\n\t\t\n\t\tthis.css(css);\n\t\treturn this;\n\t};\n\t\n\t/**\n\t * Helper function to bind to the correct transition end event\n\t * @param {function} callback The function to call when the event fires\n\t */\n\t$.fn.transitionEnd = function(callback) {\n\t\tvar _this = this;\n\t\t\n\t\tvar events = ['webkitTransitionEnd', 'transitionend', 'oTransitionEnd'];\n\t\t\n\t\tfor(var i=0; i < events.length; i++)\n\t\t{\n\t\t\tthis.bind(events[i], function(event){\n\t\t\t\t// Automatically stop listening for the event\n\t\t\t\tfor(var j=0; j<events.length;j++)\n\t\t\t\t\t$(this).unbind(events[j]);\n\n\t\t\t\t// Perform the callback function\n\t\t\t\tif(callback)\n\t\t\t\t\tcallback.call(this, event);\n\t\t\t});\n\t\t}\n\t\t\n\t\treturn this;\n\t};\n\n\tflux.transition = function(fluxslider, opts) {\n\t\tthis.options = $.extend({\n\t\t\trequires3d: false,\n\t\t\tafter: function() {\n\t\t\t\t// Default callback for after the transition has completed\n\t\t\t}\n\t\t}, opts);\n\n\t\tthis.slider = fluxslider;\n\n\t\t// We need to ensure transitions degrade gracefully if the transition is unsupported or not loaded\n\t\tif((this.options.requires3d && !flux.browser.supports3d) || !flux.browser.supportsTransitions || this.options.fallback === true)\n\t\t{\n\t\t\tvar _this = this;\n\t\t\t\n\t\t\tthis.options.after = undefined;\n\n\t\t\tthis.options.setup = function() {\n\t\t\t\t//console.error(\"Fallback setup()\");\n\t\t\t\t_this.fallbackSetup();\n\t\t\t};\n\t\t\t\n\t\t\tthis.options.execute = function() {\n\t\t\t\t//console.error(\"Fallback execute()\");\n\t\t\t\t_this.fallbackExecute();\n\t\t\t};\n\t\t}\n\t};\n\n\tflux.transition.prototype = {\n\t\tconstructor: flux.transition,\n\t\thasFinished: false, // This is a lock to ensure that the fluxTransitionEnd event is only fired once per tansition\n\t\trun: function() {\n\t\t\tvar _this = this;\n\n\t\t\t// do something\n\t\t\tif(this.options.setup !== undefined)\n\t\t\t\tthis.options.setup.call(this);\n\t\t\t\n\t\t\t// Remove the background image from the top image\n\t\t\tthis.slider.image1.css({\n\t\t\t\t'background-image': 'none'\n\t\t\t});\n\n\t\t\tthis.slider.imageContainer.css('overflow', this.options.requires3d ? 'visible' : 'hidden');\n\n\t\t\t// For some of the 3D effects using Zepto we need to delay the transitions for some reason\n\t\t\tsetTimeout(function(){\n\t\t\t\tif(_this.options.execute !== undefined)\n\t\t\t\t\t_this.options.execute.call(_this);\n\t\t\t}, 5);\n\t\t},\n\t\tfinished: function() {\n\t\t\tif(this.hasFinished)\n\t\t\t\treturn;\n\t\t\t\t\n\t\t\tthis.hasFinished = true;\n\t\t\t\n\t\t\tif(this.options.after)\n\t\t\t\tthis.options.after.call(this);\n\n\t\t\tthis.slider.imageContainer.css('overflow', 'hidden');\t\n\n\t\t\tthis.slider.setupImages();\n\n\t\t\t// Trigger an event to signal the end of a transition\n\t\t\tthis.slider.element.trigger('fluxTransitionEnd', {\n\t\t\t\tcurrentImage: this.slider.getImage(this.slider.currentImageIndex)\n\t\t\t});\n\t\t},\n\t\tfallbackSetup: function() {\n\t\t\t\n\t\t},\n\t\tfallbackExecute: function() {\n\t\t\tthis.finished();\n\t\t}\n\t};\n\n\tflux.transitions = {};\n\t\n\t// Flux grid transition\n\tflux.transition_grid = function(fluxslider, opts) {\n\t\treturn new flux.transition(fluxslider, $.extend({\n\t\t\tcolumns: 6,\n\t\t\trows: 6,\n\t\t\tforceSquare: false,\n\t\t\tsetup: function() {\n\t\t\t\tvar imgWidth = this.slider.image1.width(),\n\t\t\t\t\timgHeight = this.slider.image1.height();\n\t\t\t\t\t\n\t\t\t\tvar colWidth = Math.floor(imgWidth / this.options.columns),\n\t\t\t\t\trowHeight = Math.floor(imgHeight / this.options.rows);\n\t\t\t\t\t\n\t\t\t\tif(this.options.forceSquare)\n\t\t\t\t{\n\t\t\t\t\trowHeight = colWidth;\n\t\t\t\t\tthis.options.rows = Math.floor(imgHeight / rowHeight);\n\t\t\t\t}\n\n\t\t\t\t// Work out how much space remains with the adjusted barWidth\n\t\t\t\tvar colRemainder = imgWidth - (this.options.columns * colWidth),\n\t\t\t\t\tcolAddPerLoop = Math.ceil(colRemainder / this.options.columns),\n\t\t\t\t\t\n\t\t\t\t\trowRemainder = imgHeight - (this.options.rows * rowHeight),\n\t\t\t\t\trowAddPerLoop = Math.ceil(rowRemainder / this.options.rows),\n\t\t\t\t\t\n\t\t\t\t\tdelayBetweenBars = 150,\n\t\t\t\t\theight = this.slider.image1.height(),\n\t\t\t\t\ttotalLeft = 0,\n\t\t\t\t\ttotalTop = 0,\n\t\t\t\t\tfragment = document.createDocumentFragment();\n\t\t\t\t\n\t\t\t\tfor(var i=0; i<this.options.columns; i++) {\n\t\t\t\t\tvar thisColWidth = colWidth,\n\t\t\t\t\t\ttotalTop = 0;\n\n\t\t\t\t\tif(colRemainder > 0) {\n\t\t\t\t\t\tvar add = colRemainder >= colAddPerLoop ? colAddPerLoop : colRemainder;\n\t\t\t\t\t\tthisColWidth += add;\n\t\t\t\t\t\tcolRemainder -= add;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tfor(var j=0; j<this.options.rows; j++)\t{\n\t\t\t\t\t\tvar thisRowHeight = rowHeight,\n\t\t\t\t\t\t\tthisRowRemainder = rowRemainder;\n\n\t\t\t\t\t\tif(thisRowRemainder > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar add = thisRowRemainder >= rowAddPerLoop ? rowAddPerLoop : thisRowRemainder;\n\t\t\t\t\t\t\tthisRowHeight += add;\n\t\t\t\t\t\t\tthisRowRemainder -= add;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tvar tile = $('<div class=\"tile tile-'+i+'-'+j+'\"></div>').css({\n\t\t\t\t\t\t\twidth: thisColWidth+'px',\n\t\t\t\t\t\t\theight: thisRowHeight+'px',\n\t\t\t\t\t\t\tposition: 'absolute',\n\t\t\t\t\t\t\ttop: totalTop+'px',\n\t\t\t\t\t\t\tleft: totalLeft+'px'\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\tthis.options.renderTile.call(this, tile, i, j, thisColWidth, thisRowHeight, totalLeft, totalTop);\n\t\t\t\t\t\t\n\t\t\t\t\t\tfragment.appendChild(tile.get(0));\n\t\t\t\t\t\t\n\t\t\t\t\t\ttotalTop += thisRowHeight;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\ttotalLeft += thisColWidth;\n\t\t\t\t}\n\n\t\t\t\t// Append the fragement to the surface\n\t\t\t\tthis.slider.image1.get(0).appendChild(fragment);\n\t\t\t},\n\t\t\texecute: function() {\n\t\t\t\tvar _this = this,\n\t\t\t\t\theight = this.slider.image1.height(),\n\t\t\t\t\tbars = this.slider.image1.find('div.barcontainer');\n\n\t\t\t\tthis.slider.image2.hide();\n\n\t\t\t\t// Get notified when the last transition has completed\n\t\t\t\tbars.last().transitionEnd(function(event){\n\t\t\t\t\t_this.slider.image2.show();\n\n\t\t\t\t\t_this.finished();\n\t\t\t\t});\n\n\t\t\t\tbars.css3({\n\t\t\t\t\t'transform': flux.browser.rotateX(-90) + ' ' + flux.browser.translate(0, height/2, height/2)\n\t\t\t\t});\n\t\t\t},\n\t\t\trenderTile: function(elem, colIndex, rowIndex, colWidth, rowHeight, leftOffset, topOffset) {\n\t\t\t\t\n\t\t\t}\n\t\t}, opts));\t\n\t};\n});"]}