/**
 * skylark-fluxslider - A version of fluxslider that ported to running on skylarkjs ui.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-fluxslider/
 * @license MIT
 */
define(["skylark-jquery","./flux"],function(i,t){return t.slider=function(n,s){t.browser.init(),t.browser.supportsTransitions||window.console&&window.console.error&&console.error("Flux Slider requires a browser that supports CSS3 transitions");var e=this;for(var a in this.element=i(n),this.transitions=[],t.transitions)this.transitions.push(a);this.options=i.extend({autoplay:!0,transitions:this.transitions,delay:4e3,pagination:!0,controls:!1,captions:!1,width:null,height:null,onTransitionEnd:null},s),this.height=this.options.height?this.options.height:null,this.width=this.options.width?this.options.width:null;var o=[];i(this.options.transitions).each(function(i,n){var s=new t.transitions[n](this),e=!0;s.options.requires3d&&!t.browser.supports3d&&(e=!1),s.options.compatibilityCheck&&(e=s.options.compatibilityCheck()),e&&o.push(n)}),this.options.transitions=o,this.images=new Array,this.imageLoadedCount=0,this.currentImageIndex=0,this.nextImageIndex=1,this.playing=!1,this.container=i('<div class="fluxslider"></div>').appendTo(this.element),this.surface=i('<div class="surface" style="position: relative"></div>').appendTo(this.container),this.container.bind("click",function(t){i(t.target).hasClass("hasLink")&&(window.location=i(t.target).data("href"))}),this.imageContainer=i('<div class="images loading"></div>').css({position:"relative",overflow:"hidden","min-height":"100px"}).appendTo(this.surface),this.width&&this.height&&this.imageContainer.css({width:this.width+"px",height:this.height+"px"}),this.image1=i('<div class="image1" style="height: 100%; width: 100%"></div>').appendTo(this.imageContainer),this.image2=i('<div class="image2" style="height: 100%; width: 100%"></div>').appendTo(this.imageContainer),i(this.image1).add(this.image2).css({position:"absolute",top:"0px",left:"0px"}),this.element.find("img, a img").each(function(t,n){var s=n.cloneNode(!1),a=i(n).parent();a.is("a")&&i(s).data("href",a.attr("href")),e.images.push(s),i(n).remove()});for(var h=0;h<this.images.length;h++){var r=new Image;r.onload=function(){e.imageLoadedCount++,e.width=e.width?e.width:this.width,e.height=e.height?e.height:this.height,e.imageLoadedCount>=e.images.length&&(e.finishedLoading(),e.setupImages())},r.src=this.images[h].src}this.element.bind("fluxTransitionEnd",function(i,t){e.options.onTransitionEnd&&(i.preventDefault(),e.options.onTransitionEnd(t))}),this.options.autoplay&&this.start(),this.element.bind("swipeLeft",function(i){e.next(null,{direction:"left"})}).bind("swipeRight",function(i){e.prev(null,{direction:"right"})}),setTimeout(function(){i(window).focus(function(){e.isPlaying()&&e.next()})},100)},t.slider.prototype={constructor:t.slider,playing:!1,start:function(){var i=this;this.playing=!0,this.interval=setInterval(function(){console.log("play"),i.transition()},this.options.delay)},stop:function(){this.playing=!1,clearInterval(this.interval),this.interval=null},isPlaying:function(){return this.playing},next:function(i,t){(t=t||{}).direction="left",this.showImage(this.currentImageIndex+1,i,t)},prev:function(i,t){(t=t||{}).direction="right",this.showImage(this.currentImageIndex-1,i,t)},showImage:function(i,t,n){this.setNextIndex(i),this.setupImages(),this.transition(t,n)},finishedLoading:function(){var t=this;if(this.container.css({width:this.width+"px",height:this.height+"px"}),this.imageContainer.removeClass("loading"),this.options.pagination&&(this.pagination=i('<ul class="pagination"></ul>').css({margin:"0px",padding:"0px","text-align":"center"}),this.pagination.bind("click",function(n){n.preventDefault(),t.showImage(i(n.target).data("index"))}),i(this.images).each(function(n,s){var e=i('<li data-index="'+n+'">'+(n+1)+"</li>").css({display:"inline-block","margin-left":"0.5em",cursor:"pointer"}).appendTo(t.pagination);0==n&&e.css("margin-left",0).addClass("current")}),this.container.append(this.pagination)),i(this.imageContainer).css({width:this.width+"px",height:this.height+"px"}),i(this.image1).css({width:this.width+"px",height:this.height+"px"}),i(this.image2).css({width:this.width+"px",height:this.height+"px"}),this.container.css({width:this.width+"px",height:this.height+(this.options.pagination?this.pagination.height():0)+"px"}),this.options.controls){var n={padding:"4px 10px 10px","font-size":"60px","font-family":"arial, sans-serif","line-height":"1em","font-weight":"bold",color:"#FFF","text-decoration":"none",background:"rgba(0,0,0,0.5)",position:"absolute","z-index":2e3};this.nextButton=i('<a href="#">»</a>').css(n).css3({"border-radius":"4px"}).appendTo(this.surface).bind("click",function(i){i.preventDefault(),t.next()}),this.prevButton=i('<a href="#">«</a>').css(n).css3({"border-radius":"4px"}).appendTo(this.surface).bind("click",function(i){i.preventDefault(),t.prev()});var s=(this.height-this.nextButton.height())/2;this.nextButton.css({top:s+"px",right:"10px"}),this.prevButton.css({top:s+"px",left:"10px"})}this.options.captions&&(this.captionBar=i('<div class="caption"></div>').css({background:"rgba(0,0,0,0.6)",color:"#FFF","font-size":"16px","font-family":"helvetica, arial, sans-serif","text-decoration":"none","font-weight":"bold",padding:"1.5em 1em",opacity:0,position:"absolute","z-index":110,width:"100%",bottom:0}).css3({"transition-property":"opacity","transition-duration":"800ms","box-sizing":"border-box"}).prependTo(this.surface)),this.updateCaption()},setupImages:function(){var t=this.getImage(this.currentImageIndex),n={"background-image":'url("'+t.src+'")',"z-index":101,cursor:"auto"};i(t).data("href")?(n.cursor="pointer",this.image1.addClass("hasLink"),this.image1.data("href",i(t).data("href"))):(this.image1.removeClass("hasLink"),this.image1.data("href",null)),this.image1.css(n).children().remove(),this.image2.css({"background-image":'url("'+this.getImage(this.nextImageIndex).src+'")',"z-index":100}).show(),this.options.pagination&&this.pagination&&(this.pagination.find("li.current").removeClass("current"),i(this.pagination.find("li")[this.currentImageIndex]).addClass("current"))},transition:function(n,s){if(void 0==n||!t.transitions[n]){var e=Math.floor(Math.random()*this.options.transitions.length);n=this.options.transitions[e]}var a=null;try{a=new t.transitions[n](this,i.extend(this.options[n]?this.options[n]:{},s))}catch(i){a=new t.transition(this,{fallback:!0})}a.run(),this.currentImageIndex=this.nextImageIndex,this.setNextIndex(this.currentImageIndex+1),this.updateCaption()},updateCaption:function(){var t=i(this.getImage(this.currentImageIndex)).attr("title");this.options.captions&&this.captionBar&&(""!==t&&this.captionBar.html(t),this.captionBar.css("opacity",""===t?0:1))},getImage:function(i){return i%=this.images.length,this.images[i]},setNextIndex:function(i){void 0==i&&(i=this.currentImageIndex+1),this.nextImageIndex=i,this.nextImageIndex>this.images.length-1&&(this.nextImageIndex=0),this.nextImageIndex<0&&(this.nextImageIndex=this.images.length-1)},increment:function(){this.currentImageIndex++,this.currentImageIndex>this.images.length-1&&(this.currentImageIndex=0)}},t.slider});
//# sourceMappingURL=sourcemaps/flux.slider.js.map
